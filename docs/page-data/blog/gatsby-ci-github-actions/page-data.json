{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/gatsby-ci-github-actions","webpackCompilationHash":"9aec823b80822b957d24","result":{"data":{"markdownRemark":{"html":"<h2>The Dumb Way</h2>\n<p>For the longest time, ever since I first learned about Github Actions, I've wanted a quick easy way to automate deployment for this Gatsby blog.</p>\n<p>The idea is simple yet beautiful.</p>\n<ol>\n<li>Edit Markdown</li>\n<li>Commit</li>\n<li><em>Magic</em></li>\n</ol>\n<p>Gatsby build already deploys static files, so the only real challenge is pushing it to the github.io repo. Of course the lazy way is simply to git init in the directory, set origin and <em><strong>FORCE PUSH!!!!</strong></em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token string\">\"deploy\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"gatsby build &amp;&amp; cd public &amp;&amp; git add . &amp;&amp; git commit -m 'deploy' &amp;&amp; git push --force\"</span></code></pre></div>\n<p><em><em>Obi wan has taught me well</em></em></p>\n<h2>The Fancy Way</h2>\n<p>The previous way works, but it's not very pretty. Kinda like hammering a nail with a big rock. Why are we building and pushing the artifacts locally when we have fancy <em>Github Actions</em> to do this for us?</p>\n<p>Turns out setting up a github action is really simple. All you need is a YAML file.</p>\n<p><code class=\"language-text\">.github/deploy.yml</code></p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> CI <span class=\"token punctuation\">-</span> Build and Deploy to Github Pages Repo\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>push<span class=\"token punctuation\">]</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n<span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n<span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v1\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          npm install\n          npm run build</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">ACCESS_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.ACCESS_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          cd ${{ github.workspace }}/public\n          git init\n          git add .\n          git config --local user.email \"action@github.com\"\n          git config --local user.name \"GitHub Action\"\n          git commit -m \"Build artifacts\"\n          git remote add origin https://$ACCESS_TOKEN@github.com/danielkhoo/danielkhoo.github.io.git\n          git push --set-upstream origin master --force</span></code></pre></div>\n<p>Note that I had to generate a separate ACCESS_TOKEN to access the other repo.</p>\n<p><code class=\"language-text\">GitHub Settings / Developer settings / Personal access tokens</code></p>\n<p>Once generated, add it as a secret in the current repo under <code class=\"language-text\">Settings / Secrets</code></p>\n<blockquote>\n<p>And that's it! Automatic Gatsby build and deploy on push. Magic</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ea7e8ac29d7a09a56c8978bdc1c4acd5/15f59/ss2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.74873864783048%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABjElEQVQoz6WRSU4CQRSG+xQuHIJKA9LNJEMQ47j2AuoFvATGkTCIrnXhxpUH8AJOceO41WAMYBARewCBpjG/r0ohxujKSr687r/+/t/rKkHXK1AJjahUa3hVNWiajmI2A/3lib+XFRXVtxp5qlBUnVdVo+/Ip9C+QrVhNFFvGBDyBQU3VxfI5R9hNE203t/xnyXUanU+idmowqhXuJjLPmAtlkBiY5PYQpJgNZ7aRDLNahqxRArr8SSRwsp6HNGlVSwur0G4uivi+l7BZaaM89tnZEot7B8com/QAYfbD5vkRb9dhkWUuGYRnbDLPtjkT33AIaOX9K6eAXRbRAgLewXM7eSIPGa3s5jfLWEmegC7y4vQ6CTH5QvB6QnwcIbo9HSeGayBwzUMmXwCOzfT/KRhGPyXT07PIFLgyPg0AuExBEbGIXmDsA65edhPmM5C3f4whKbZQht2S2wdn5zBKnkQHpuirkH026RO2G+hTGOTSt6vCdu0A48ocJBMvlAEwcgEN/813fcmQ3TmHzLwqgL3Az0xAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CI\"\n        title=\"CI\"\n        src=\"/static/ea7e8ac29d7a09a56c8978bdc1c4acd5/8ff1e/ss2.png\"\n        srcset=\"/static/ea7e8ac29d7a09a56c8978bdc1c4acd5/9ec3c/ss2.png 200w,\n/static/ea7e8ac29d7a09a56c8978bdc1c4acd5/c7805/ss2.png 400w,\n/static/ea7e8ac29d7a09a56c8978bdc1c4acd5/8ff1e/ss2.png 800w,\n/static/ea7e8ac29d7a09a56c8978bdc1c4acd5/15f59/ss2.png 991w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>","frontmatter":{"date":"December 16, 2019","path":"/blog/gatsby-ci-github-actions","title":"Deploy Gatsby on commit with Github Actions"}}},"pageContext":{"isCreatedByStatefulCreatePages":false}}}